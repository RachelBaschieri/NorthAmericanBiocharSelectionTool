<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Soil Analysis Form</title>
</head>
<body>
    <h1>Soil Analysis Form</h1>

    <form method="post" action="/select_crop">
        <label for="moisture">Soil Moisture (%):</label>
        <input type="text" id="moisture" name="moisture" required>
        <br><br>

        <label for="organic_matter">Organic Matter (%):</label>
        <input type="text" id="organic_matter" name="organic_matter" required>
        <br><br>

        <label for="phosphorus">Phosphorus (ppm):</label>
        <input type="text" id="phosphorus" name="phosphorus" required>
        <br><br>

        <label for="potassium">Potassium (ppm):</label>
        <input type="text" id="potassium" name="potassium" required>
        <br><br>

        <label for="available_N">Plant available N (either NH4+/NO3-) (ppm):</label>
        <input type="text" id="available_N" name="available_N" required>
        <br><br>

        <label for="pH">pH:</label>
        <input type="text" id="pH" name="pH" required>
        <br><br>

        <label for="sand">Sand (%):</label>
        <input type="text" id="sand" name="sand" required>
        <br><br>

        <label for="silt">Silt (%):</label>
        <input type="text" id="silt" name="silt" required>
        <br><br>

        <label for="clay">Clay (%):</label>
        <input type="text" id="clay" name="clay" required>
        <br><br>

        <h2>Select Crop</h2>
        <label for="crop">Choose a crop:</label>
        <select name="crop" id="crop">
            {% for crop in crops %}
                <option value="{{ crop.Crop }}">{{ crop.Crop }}</option>
            {% endfor %}
        </select>

        <br><br>
        <input type="submit" value="Submit">
    </form>

    <!-- Display any messages from the server -->
    {% if messages %}
        <div>
            {% for message in messages %}
                <p>{{ message }}</p>
            {% endfor %}
        </div>
    {% endif %}

    {% if data %}
    <h2>Submitted Data:</h2>
    <ul>
      {% for key, value in data.items() %}
        <li>{{ key }}: {{ value }}</li>
      {% endfor %}
    </ul>
    {% if messages %}
      <h3>Messages:</h3>
      <ul>
        {% for key, value in messages.items() %}
          <li>{{ value }}</li>
        {% endfor %}
      </ul>
    {% endif %}
  {% endif %}

  <!-- Hidden fields to carry previously submitted data -->
  <input type="hidden" name="moisture" value="{{ data['Soil Moisture (%)'] }}">
  <input type="hidden" name="organic_matter" value="{{ data['Organic Matter (%)'] }}">
  <input type="hidden" name="phosphorus" value="{{ data['Phosphorus (ppm)'] }}">
  <input type="hidden" name="potassium" value="{{ data['Potassium (ppm)'] }}">
  <input type="hidden" name="available_N" value="{{ data['Plant available Nitrogen (either NH4+/NO3-) (ppm)'] }}">
  <input type="hidden" name="pH" value="{{ data['pH'] }}">
  <input type="hidden" name="sand" value="{{ data['Sand (%)'] }}">
  <input type="hidden" name="silt" value="{{ data['Silt (%)'] }}">
  <input type="hidden" name="clay" value="{{ data['Clay (%)'] }}">
</form>

{% if crop_data %}
        <h2>Crop Requirements:</h2>
        <ul>
            <li>Required Phosphorus (lbs/acre): {{ crop_data['Required Phosphorus (lbs/acre)'] }}</li>
            <li>Required Potassium (lbs/acre): {{ crop_data['Required Potassium (lbs/acre)'] }}</li>
            <li>Required Nitrogen (lbs/acre): {{ crop_data['Required Nitrogen (lbs/acre)'] }}</li>
           
            {% if 'Required Lime (lbs/acre)' in crop_data %}
                <li>Required Lime (lbs/acre): {{ crop_data['Required Lime (lbs/acre)'] }}</li>
            {% endif %}
        </ul>
    {% endif %}

    <!-- Display Biochar Recommendations -->
    {% if biochar_results %}
        <h2>Top 5 Biochar Matches:</h2>
       
        <h3>Phosphorus</h3>
        <table border="1">
            <tr>
                <th>Sample Name</th>
                <th>Extractable P (lbs/ton)</th>
            </tr>
            {% for sample in biochar_results.phosphorus %}
            <tr>
                <td>{{ sample.Sample }}</td>
                <td>{{ sample.ExtractablePlbs1ton }}</td>
            </tr>
            {% endfor %}
        </table>

        <h3>Potassium</h3>
        <table border="1">
            <tr>
                <th>Sample Name</th>
                <th>K (lbs/ton)</th>
            </tr>
            {% for sample in biochar_results.potassium %}
            <tr>
                <td>{{ sample.Sample }}</td>
                <td>{{ sample.Klb_1ton }}</td>
            </tr>
            {% endfor %}
        </table>

        <h3>Nitrogen</h3>
        <table border="1">
            <tr>
                <th>Sample Name</th>
                <th>N (lbs/ton)</th>
            </tr>
            {% for sample in biochar_results.nitrogen %}
            <tr>
                <td>{{ sample.Sample }}</td>
                <td>{{ sample.Plant_available_Nlbs_1ton }}</td>
            </tr>
            {% endfor %}
        </table>
        
        {% if 'Required Lime (lbs/acre)' in crop_data %}
        <h3>CaCO3eq</h3>
        <table border="1">
            <tr>
                <th>Sample Name</th>
                <th>CaCO3 (lbs/ton)</th>
            </tr>
            {% for sample in biochar_results.lime %}
            <tr>
                <td>{{ sample.Sample }}</td>
                <td>{{ sample.CaCO3lb_1ton}}</td>
            </tr>
            {% endfor %}
        </table>
    {% endif %}
    {% endif %}
</body>
</html>